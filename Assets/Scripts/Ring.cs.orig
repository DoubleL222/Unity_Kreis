using UnityEngine;
using System.Collections;
using System.Collections.Generic;

public class Ring {

	public float radius_scale_factor;
	public float real_radius = 285.0f;
	public double cushioning = 26.9; // 69
	public double offset_arena = 0.0;

	private GameObject segPrefab;

	public List<SegmentController> segments;
	private double segment_delta;

	public Ring(float r){
<<<<<<< HEAD

		segments = new List<GameObject> ();
		radius_scale_factor = r;
		segPrefab = Resources.Load ("SegmentPrefab") as GameObject;

		this.cushioning = this.cushioning * r;
		this.segment_delta = 1.0 / (double)segments.Count;
=======
		segments = new List<SegmentController> ();
		radius_scale_factor = r;
		segPrefab = Resources.Load ("SegmentPrefab") as GameObject;
>>>>>>> 8cbcc0d3b8255c48d0739b13be0b2b5940fcdfe1
	}
	public void spawnRing(){

		float scale;
		for (int i=0; i<37; i++) {
			GameObject currSegment = MonoBehaviour.Instantiate(segPrefab, Vector3.zero, Quaternion.Euler(0, 0, i*10)) as GameObject;
			currSegment.transform.localScale = new Vector3(radius_scale_factor, radius_scale_factor, radius_scale_factor);
			segments.Add(currSegment.GetComponent<SegmentController>() as SegmentController);
		}
		this.segment_delta = 1.0 / (double)segments.Count;
	}


	// UTIL FUNC ------------------------------------------------------------------------------------
	// ----------------------------------------------------------------------------------------------

	// global offset -> local offset
	public double get_ring_offset_from_global_offset(double offset) {
		
		if (offset > this.offset_arena) {

			double value = offset - this.offset_arena;
			return value;
		}
		else {

			double missing_to_full = 1.0 - this.offset_arena;
			double value = missing_to_full + offset;
			return value;
		}
	}


	// global offset -> Segment
	public SegmentController get_ring_segment_from_global_offset(double offset) {
		
		if (offset > this.offset_arena) {
			
			double value = offset - this.offset_arena;	// local offset
			SegmentController wanted_segment = get_segment_from_local_offset(value);
			return wanted_segment;
		}
		else {
			
			double missing_to_full = 1.0 - this.offset_arena;
			double value = missing_to_full + offset;	// local offset
			SegmentController wanted_segment = get_segment_from_local_offset(value);
			return wanted_segment;
		}
	}


	// local offset -> segment
	public SegmentController get_segment_from_local_offset(double offset) {
		
		int seg_index = this.get_segment_index_from_local_offset (offset);
		return this.segments[seg_index];
	}


	// local offset -> segment index
	public int get_segment_index_from_local_offset(double offset) {
		
		return  (int)Mathf.Floor((float)offset / (float)this.segment_delta);
	}

	// ----------------------------------------------------------------------------------------------
	// END UTIL FUNC --------------------------------------------------------------------------------
}